<?xml version="1.0" encoding="UTF-8"?>
<installer-gui-script minSpecVersion="1.0">          
    <title>FUSE for OS X (OSXFUSE)</title>
    <background file="background.png" scaling="none" alignment="center"/>
    <welcome file="Welcome.rtf"/>
    <license file="License.rtf"/>
    <options customize="always" rootVolumeOnly="true"/>
    <choices-outline>
        <line choice="OSXFUSECore"/>
        <line choice="OSXFUSEPrefPane"/>
        <line choice="OSXFUSEMacFUSE"/>
    </choices-outline>
    <choice id="OSXFUSECore"
            title="CORE_TITLE"
            description="CORE_DESCRIPTION"
            start_selected="true"
            start_enabled="false">
        <pkg-ref id="@PKG_CORE_ID@"
                 installKBytes="@PKG_CORE_SIZE@"
                 version="@PKG_CORE_VERSION@"
                 auth="Root">#@PKG_CORE_NAME@</pkg-ref>
    </choice>
    <choice id="OSXFUSEPrefPane"
            title="PREFPANE_TITLE"
            description="PREFPANE_DESCRIPTION"
            start_selected="! isInstalled('OSXFUSECore') || isInstalled('OSXFUSEPrefPane')"
            start_enabled="! isUpdate('OSXFUSEPrefPane')">
        <pkg-ref id="@PKG_PREFPANE_ID@"
                 installKBytes="@PKG_PREFPANE_SIZE@"
                 version="@PKG_PREFPANE_VERSION@"
                 auth="Root">#@PKG_PREFPANE_NAME@</pkg-ref>
    </choice>
    <choice id="OSXFUSEMacFUSE"
            title="MACFUSE_TITLE"
            description="MACFUSE_DESCRIPTION"
            start_selected="isUpdate('OSXFUSEMacFUSE')"
            start_enabled="! isUpdate('OSXFUSEMacFUSE')">
        <pkg-ref id="@PKG_MACFUSE_ID@" 
                 installKBytes="@PKG_MACFUSE_SIZE@"
                 version="@PKG_MACFUSE_VERSION@"
                 auth="Root">#@PKG_MACFUSE_NAME@</pkg-ref>
    </choice>
    <installation-check script='installationCheck()'/>
    <script>
        function installationCheck() 
        {
            if (system.compareVersions(system.version.ProductVersion, '10.5') &lt; 0)
            {
                my.result.type = 'Fatal';
                my.result.message = system.localizedString('ERROR_OSXTOOOLD');
                return(false);
            }
            return true;
        }
        function isInstalled(choice)
        {
            return choices['OSXFUSECore'].packageUpgradeAction != 'clean' &amp;&amp;
                   choices[choice].packageUpgradeAction != 'clean';
        }
        function isUpdate(choice)
        {
            if (choice == 'OSXFUSEMacFUSE')
            {
                return choices['OSXFUSEMacFUSE'].packageUpgradeAction != 'clean' &amp;&amp; 
                       ! system.files.fileExistsAtPath(
                               '/Library/Filesystems/fusefs.fs/Contents/Info.plist')
            }
            else
            {
                return choices[choice].packageUpgradeAction != 'clean'
            } 
        }
    </script>
</installer-gui-script>